server {
    listen       80;
    server_name  _;

    # Serve from default html dir
    root /usr/share/nginx/html;
    index index.html;

    # Ensure correct MIME types (guard against missing global mime.types include)
    types {
        text/html  html htm shtml;
        text/css   css;
        text/javascript  js mjs;
        application/javascript js mjs;
        application/json json map;
        application/wasm wasm;
        image/svg+xml svg;
    }

    # Compression
    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss image/svg+xml;
    gzip_min_length 1024;
    gzip_comp_level 5;

    # Static assets with long caching
    location ~* \.(js|mjs|css|json|wasm|map)$ {
        add_header Cache-Control "public, max-age=31536000, immutable";
        try_files $uri =404;
    }

    # Cache static assets aggressively
    location ~* \.(ico|png|jpg|jpeg|gif|svg|webp|woff|woff2|ttf|eot)$ {
        add_header Cache-Control "public, max-age=31536000, immutable";
        try_files $uri =404;
    }

    # App routes (SPA)
    location / {
        try_files $uri /index.html;
        add_header Cache-Control "no-store";
    }
}


